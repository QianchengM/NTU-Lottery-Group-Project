<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>My History - NTU Lottery</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { background-color: #f8f9fa; padding: 20px; }
        .history-card {
            background: white; border-radius: 10px; padding: 20px; box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }
        /* å®šä¹‰ä¸åŒå¥–å“çš„æ ·å¼ */
        .record-type-1 { color: #d63384; font-weight: bold; background-color: #fff0f6; } /* å®ç‰©å¤§å¥– */
        .record-type-2 { color: #198754; font-weight: bold; } /* è™šæ‹Ÿåˆ¸ */
        .record-type-0 { color: #adb5bd; } /* è°¢è°¢æƒ é¡¾ */
    </style>
</head>
<body>

<div class="container">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h3>ğŸ“œ Draw History</h3>
        <a href="/" class="btn btn-outline-secondary">â† Back Home</a>
    </div>

    <div class="history-card">
        <table class="table table-hover align-middle">
            <thead class="table-light">
                <tr>
                    <th scope="col">Time</th>
                    <th scope="col">Prize Name</th>
                    <th scope="col">Type</th>
                </tr>
            </thead>
            <tbody id="historyList">
                </tbody>
        </table>
        <div id="emptyMsg" class="text-center text-muted mt-3" style="display:none;">
            No records found.
        </div>
    </div>
</div>

<script>
    window.onload = function() {
        loadHistory();
    };

    function loadHistory() {
        // è¿™é‡Œ userId=1 (Alice)
        fetch('/user/history?userId=1')
            .then(res => res.json())
            .then(data => {
                const tbody = document.getElementById('historyList');
                tbody.innerHTML = '';

                if (data.length === 0) {
                    document.getElementById('emptyMsg').style.display = 'block';
                    return;
                }

                data.forEach(record => {
                    // 1. æ ¼å¼åŒ–æ—¶é—´ (æŠŠ 2026-01-23T17:00:54 å˜æˆæ›´æ˜“è¯»çš„æ ¼å¼)
                    let rawTime = record.create_time; 
                    let displayTime = rawTime.replace('T', ' ').split('.')[0]; 

                    // 2. æ ¹æ®ç±»å‹å†³å®šæ ·å¼
                    // type: 1(å®ç‰©), 2(åˆ¸), 0(æœªä¸­å¥–)
                    let rowClass = `record-type-${record.prize_type}`;
                    let typeLabel = "Missed";
                    if(record.prize_type === 1) typeLabel = "ğŸ Real Prize";
                    if(record.prize_type === 2) typeLabel = "ğŸ« Voucher";

                    // 3. æ¸²æŸ“è¡Œ
                    tbody.innerHTML += `
                        <tr class="${rowClass}">
                            <td>${displayTime}</td>
                            <td>${record.prize_name}</td>
                            <td><span class="badge bg-light text-dark border">${typeLabel}</span></td>
                        </tr>
                    `;
                });
            });
    }
</script>

</body>
</html>